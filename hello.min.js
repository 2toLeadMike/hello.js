/** CopyRight Andrew Dodson http://adodson.com/hello.js */
var hello=function(){var _jsonp_counter=0;var listeners={};var shy={position:"absolute",left:"-1000px",bottom:0,height:"1px",width:"1px"};var _timeout=2E4;var _initstarted=false;var _options={redirect_uri:window.location.href.split("#")[0],response_type:"token",display:"popup",state:""};function formatItem(o){if(o.error)return;if(!o.name)o.name=o.title||o.message||o.message;if(!o.picture)o.picture=o.thumbnailLink;if(!o.thumbnail)o.thumbnail=o.thumbnailLink;if(o.mimeType==="application/vnd.google-apps.folder"){o.type=
"folder";o.files="https://www.googleapis.com/drive/v2/files?q=%22"+o.id+"%22+in+parents"}}function gEntry(o){var entry=function(a){var i=0,_a;var p={id:a.id.$t,name:a.title.$t,description:a.summary.$t,updated_time:a.updated.$t,created_time:a.published.$t,picture:a["media$group"]["media$content"][0].url,thumbnail:a["media$group"]["media$content"][0].url,width:a["media$group"]["media$content"][0].width,height:a["media$group"]["media$content"][0].height};if("link"in a)for(i=0;i<a.link.length;i++)if(a.link[i].rel.match(/\#feed$/)){p.photos=
a.link[i].href;p.files=a.link[i].href;p.upload_location=a.link[i].href;break}if("category"in a&&a["category"].length){_a=a["category"];for(i=0;i<_a.length;i++)if(_a[i].scheme&&_a[i].scheme.match(/\#kind$/))p.type=_a[i].term.replace(/^.*?\#/,"")}if("media$thumbnail"in a["media$group"]){_a=a["media$group"]["media$thumbnail"];p.thumbnail=a["media$group"]["media$thumbnail"][0].url;p.images=[];for(i=0;i<_a.length;i++)p.images.push({source:_a[i].url,width:_a[i].width,height:_a[i].height});p.images.push({source:a["media$group"]["media$content"][0].url,
width:a["media$group"]["media$content"][0].width,height:a["media$group"]["media$content"][0].height})}return p};var r=[];if("feed"in o&&"entry"in o.feed){for(i=0;i<o.feed.entry.length;i++)r.push(entry(o.feed.entry[i]));return{data:r}}if("entry"in o)return entry(o.entry);else if("items"in o){for(var i=0;i<o.items.length;i++)formatItem(o.items[i]);return{data:o.items}}else{formatItem(o);return o}}function has_binary(data){for(var x in data)if(data.hasOwnProperty(x))if(_domInstance("input",data[x])&&
data[x].type==="file"||"FileList"in window&&data[x]instanceof window.FileList||"File"in window&&data[x]instanceof window.File||"Blob"in window&&data[x]instanceof window.Blob)return true;return false}var _services={google:{name:"Google Plus",uri:{auth:"https://accounts.google.com/o/oauth2/auth",me:"oauth2/v1/userinfo?alt=json",base:"https://www.googleapis.com/","me/friends":"https://www.google.com/m8/feeds/contacts/default/full?alt=json&max-results=1000","me/share":"plus/v1/people/me/activities/public",
"me/feed":"plus/v1/people/me/activities/public","me/albums":"https://picasaweb.google.com/data/feed/api/user/default?alt=json","me/photos":"https://picasaweb.google.com/data/feed/api/user/default?alt=json&kind=photo&max-results=100","me/files":"https://www.googleapis.com/drive/v2/files?q=%22root%22+in+parents"},scope:{basic:"https://www.googleapis.com/auth/plus.me https://www.googleapis.com/auth/userinfo.email https://www.googleapis.com/auth/userinfo.profile",email:"",birthday:"",events:"",photos:"https://picasaweb.google.com/data/",
videos:"http://gdata.youtube.com",friends:"https://www.google.com/m8/feeds",files:"https://www.googleapis.com/auth/drive.readonly",publish:"",publish_files:"https://www.googleapis.com/auth/drive",create_event:"",offline_access:""},scope_delim:" ",wrap:{me:function(o){if(o.id){o.last_name=o.family_name||o.name.familyName;o.first_name=o.given_name||o.name.givenName;o.picture=o.picture||o.image.url;o.thumbnail=o.picture;o.name=o.displayName||o.name}return o},"me/friends":function(o){var r=[];if("feed"in
o&&"entry"in o.feed){for(var i=0;i<o.feed.entry.length;i++){var a=o.feed.entry[i];r.push({id:a.id.$t,name:a.title.$t,email:a.gd$email&&a.gd$email.length>0?a.gd$email[0].address:null,updated_time:a.updated.$t,picture:a.link&&a.link.length>0?a.link[0].href+"?access_token="+hello.getAuthResponse("google").access_token:null,thumbnail:a.link&&a.link.length>0?a.link[0].href+"?access_token="+hello.getAuthResponse("google").access_token:null})}return{data:r}}return o},"me/share":function(o){o.data=o.items;
try{delete o.items}catch(e){o.items=null}return o},"me/feed":function(o){o.data=o.items;try{delete o.items}catch(e){o.items=null}return o},"me/albums":gEntry,"me/photos":gEntry,"default":gEntry},xhr:function(p){if(p.method==="post"){if(p.data.file);return false}return{}}},windows:{name:"Windows live",uri:{auth:"https://oauth.live.com/authorize",base:"https://apis.live.net/v5.0/","me/share":function(p,callback){callback(p.method==="get"?"me/feed":"me/share")},"me/feed":function(p,callback){callback(p.method===
"get"?"me/feed":"me/share")},"me/files":"me/skydrive/files"},scope:{basic:"wl.signin,wl.basic",email:"wl.emails",birthday:"wl.birthday",events:"wl.calendars",photos:"wl.photos",videos:"wl.photos",friends:"",files:"wl.skydrive",publish:"wl.share",publish_files:"wl.skydrive_update",create_event:"wl.calendars_update,wl.events_create",offline_access:"wl.offline_access"},wrap:{me:function(o){if(o.id){o.email=o.emails?o.emails.preferred:null;o.picture="https://apis.live.net/v5.0/"+o.id+"/picture?access_token="+
hello.getAuthResponse("windows").access_token;o.thumbnail="https://apis.live.net/v5.0/"+o.id+"/picture?access_token="+hello.getAuthResponse("windows").access_token}return o},"me/friends":function(o){if("data"in o)for(var i=0;i<o.data.length;i++){o.data[i].picture="https://apis.live.net/v5.0/"+o.data[i].id+"/picture?access_token="+hello.getAuthResponse("windows").access_token;o.data[i].thumbnail="https://apis.live.net/v5.0/"+o.data[i].id+"/picture?access_token="+hello.getAuthResponse("windows").access_token}return o},
"me/albums":function(o){if("data"in o)for(var i=0;i<o.data.length;i++){o.data[i].photos="https://apis.live.net/v5.0/"+o.data[i].id+"/photos";o.data[i].files="https://apis.live.net/v5.0/"+o.data[i].id+"/photos"}return o},"default":function(o){if("data"in o)for(var i=0;i<o.data.length;i++)if(o.data[i].picture)o.data[i].thumbnail=o.data[i].picture;return o}},xhr:function(p){if(p.method==="post"&&!has_binary(p.data)){p.data=JSON.stringify(p.data);return{contentType:"application/json"}}return{}},jsonp:function(p){if(p.method.toLowerCase()!==
"get"){p.data.method=p.method.toLowerCase();p.method="get"}return p}},facebook:{name:"Facebook",uri:{auth:"http://www.facebook.com/dialog/oauth/",base:"https://graph.facebook.com/","me/share":"me/feed","me/files":"me/albums"},scope:{basic:"",email:"email",birthday:"user_birthday",events:"user_events",photos:"user_photos,user_videos",videos:"user_photos,user_videos",friends:"",files:"user_photos,user_videos",publish_files:"user_photos,user_videos,publish_stream",publish:"publish_stream",create_event:"create_event",
offline_access:"offline_access"},wrap:{me:function(o){if(o.id){o.picture="http://graph.facebook.com/"+o.id+"/picture";o.thumbnail="http://graph.facebook.com/"+o.id+"/picture"}return o},"me/friends":function(o){if("data"in o)for(var i=0;i<o.data.length;i++){o.data[i].picture="http://graph.facebook.com/"+o.data[i].id+"/picture";o.data[i].thumbnail="http://graph.facebook.com/"+o.data[i].id+"/picture"}return o},"me/albums":function(o){if("data"in o)for(var i=0;i<o.data.length;i++){o.data[i].files="https://graph.facebook.com/"+
o.data[i].id+"/photos";o.data[i].photos="https://graph.facebook.com/"+o.data[i].id+"/photos";if(o.data[i].cover_photo)o.data[i].thumbnail="https://graph.facebook.com/"+o.data[i].cover_photo+"/picture?access_token="+hello.getAuthResponse("facebook").access_token;o.data[i].type="album";if(o.data[i].can_upload)o.data[i].upload_location="https://graph.facebook.com/"+o.data[i].id+"/photos"}return o},"me/files":function(o){return this["me/albums"](o)},"default":function(o){if("data"in o)for(var i=0;i<o.data.length;i++){if(o.data[i].picture)o.data[i].thumbnail=
o.data[i].picture;if(o.data[i].cover_photo)o.data[i].thumbnail="https://graph.facebook.com/"+o.data[i].cover_photo+"/picture?access_token="+hello.getAuthResponse("facebook").access_token}return o}},xhr:function(p){if(p.method==="get"||p.method==="post")return{};else return false},jsonp:function(p){if(p.method.toLowerCase()!=="get"&&!has_binary(p.data)){p.data.method=p.method.toLowerCase();p.method="get"}return p},post:function(p){return{callbackonload:true}}}};var hello={service:function(service){if(typeof service!==
"undefined")return _store("sync_service",service);return _store("sync_service")},init:function(services,opts,timeout){if(!services)return _services;var p=_arguments({services:"o!",opts:"o",timeout:"i"},arguments);for(var x in p.services)if(p.services.hasOwnProperty(x))if(typeof p.services[x]!=="object")p.services[x]={id:p.services[x]};_services=_merge(_services,p.services);if(p.opts){_options=_merge(_options,p.opts);if("redirect_uri"in p.opts)_options.redirect_uri=_realPath(p.opts.redirect_uri)}if(p.timeout)_timeout=
p.timeout;if(_initstarted)return _services;else _initstarted=true;var old_tokens={},pending={};(function self(){var error=_store("error"),cb=null;if(error&&"callback"in error&&error.callback in listeners){cb=error.callback;try{delete error.callback}catch(e){}_store("error",error);hello.trigger(cb,error)}for(var x in _services)if(_services.hasOwnProperty(x)){var session=hello.getAuthResponse(x);var token=session?session.access_token:null;var evt="";if(session&&"callback"in session&&session.callback in
listeners){cb=session.callback;try{delete session.callback}catch(e){}_store(x,session);hello.trigger(cb,{network:x,authResponse:session})}if(session&&"expires"in session&&(!(x in pending)||pending[x]<(new Date).getTime()/1E3)&&session.expires<(new Date).getTime()/1E3){log(x+" has expired trying to resignin");hello.login(x,{display:"none"});pending[x]=(new Date).getTime()/1E3+600}if(old_tokens[x]===token)continue;else hello.trigger(x+":auth."+(!token?"logout":"login"),{network:x,authResponse:session});
old_tokens[x]=token}setTimeout(self,1E3)})();return _services},login:function(network,opts,callback){var url,p=_arguments({network:"s!",options:"o",callback:"f"},arguments);p.options=_merge(_options,p.options||{});if(typeof p.network!=="string")log("Please specify a service.");var provider=_services[p.network],callback_id="";var responded=false;if(p.callback){callback_id=""+Math.round(Math.random()*1E9);this.subscribe(callback_id,function self(){responded=true;hello.unsubscribe(callback_id,self);
p.callback.apply(this,arguments)})}var qs=_merge(p.options,{client_id:provider.id,scope:provider.scope.basic,state:{network:p.network,display:p.options.display,callback:callback_id,state:p.options.state}});var scope=p.options.scope;if(scope){if(typeof scope!=="string")scope=scope.join(",");qs.state.scope=scope.split(/,\s/);qs.scope=(qs.scope+","+scope).replace(/[^,\s]+/ig,function(m){return m in provider.scope?provider.scope[m]:m});qs.scope=_unique(qs.scope.split(/,+/)).join(provider.scope_delim||
",")}var session=hello.getAuthResponse(p.network);if(session&&"expires"in session&&session.expires>(new Date).getTime()/1E3){var diff=_diff(session.scope||[],qs.state.scope||[]);if(diff.length===0){this.trigger(callback_id+".login",{network:p.network,authResponse:session});return}}qs.redirect_uri=_realPath(qs.redirect_uri);qs.state=JSON.stringify(qs.state);url=provider.uri.auth+"?"+_param(qs);if(qs.display==="none")_append("iframe",{src:url,style:shy},"body");else if(qs.display==="popup"){var popup=
window.open(url,"Authentication","resizeable=true,height=550,width=500,left="+(window.innerWidth-500)/2+",top="+(window.innerHeight-550)/2);var self=this;var timer=setInterval(function(){if(popup.closed){clearInterval(timer);if(!responded)self.trigger(callback_id+".failed",{error:{code:"user_cancelled",message:"Cancelled"},network:p.network})}},100)}else window.location=url;return{url:url,method:qs.display}},logout:function(s,callback){if(s&&_store(s))_store(s,"");else if(!s){for(var x in _services)if(_services.hasOwnProperty(x))hello.logout(x);
hello.service(false)}else log(s+" had no session");if(callback)callback(false)},api:function(){var p=_arguments({path:"s!",method:"s",data:"o",timeout:"i",callback:"f"},arguments);p.method=(p.method||"get").toLowerCase();p.data=p.data||{};p.path=p.path.replace(/^\/+/,"");var a=(p.path.split(/[\/\:]/,2)||[])[0].toLowerCase();var service;if(a in _services){service=a;var reg=new RegExp("^"+a+":?/?");p.path=p.path.replace(reg,"")}else service=this.service();p.callback=p.callback||function(){};_timeout=
p.timeout||_timeout;log("API:",p);var o=_services[service];if(!o){log("No user");p.callback(false);return}var callback=p.callback;if(o.wrap&&(p.path in o.wrap||"default"in o.wrap))callback=function(r){var wrap=p.path in o.wrap?p.path:"default";log(p.path,r);p.callback(o.wrap[wrap](r))};if(!(p.path in o.uri)||o.uri[p.path]!==false){var url=p.path in o.uri?o.uri[p.path]:p.path,session=this.getAuthResponse(service),token=session?session.access_token:null;var getPath=function(url){if(!url.match(/^https?:\/\//))url=
o.uri.base+url;var qs={};if(token)qs.access_token=token;var request=function(){url+=url.indexOf("?")>-1?"&":"?";if(!_isEmpty(p.data)&&!_dataToJSON(p)){_post(url+_param(qs),p.data,"post"in o?o.post(p):null,callback);return}var config={};if(p.method==="delete"){var _callback=callback;callback=function(r){_callback(!r||_isEmpty(r)?{response:"deleted"}:r)}}if("withCredentials"in new XMLHttpRequest&&(!("xhr"in o)||(config=o.xhr(p)))){var r=new XMLHttpRequest;r.onload=function(e){var json=r.responseText?
JSON.parse(r.responseText):null;callback(json||(p.method!=="delete"?{error:{message:"Could not get resource"}}:{}))};r.onerror=function(e){callback(r.responseText?JSON.parse(r.responseText):{error:{message:"There was an error accessing "+url}})};qs.suppress_response_codes=true;url+=_param(qs);if(p.method==="get"||p.method==="delete"){if(!_isEmpty(p.data))url+=(url.indexOf("?")===-1?"?":"&")+_param(p.data);p.data=null}else if(p.data&&typeof p.data!=="string"&&!(p.data instanceof FormData)){var f=new FormData;
for(var x in p.data)if(p.data.hasOwnProperty(x))if(p.data[x]instanceof HTMLInputElement){if("files"in p.data[x]&&p.data[x].files.length>0)f.append(x,p.data[x].files[0])}else f.append(x,p.data[x]);p.data=f}r.open(p.method.toUpperCase(),url);if(config.contentType)r.setRequestHeader("Content-Type",config.contentType);if(p.data&&p.data instanceof FormData&&"fake"in p.data&&p.data.fake){r.setRequestHeader("Content-Type","multipart/form-data; boundary="+p.data.boundary);r.sendAsBinary(p.data.toString())}else r.send(p.data);
return{url:url,method:"XHR",data:p.data}}if("jsonp"in o)p=o.jsonp(p);if(p.method==="post")return{url:_post(url+_param(qs),p.data,"post"in o?o.post(p):null,callback),method:"POST",data:p.data};else{qs.callback="?";return{url:_jsonp(url+_param(qs),p.data,callback),method:"JSONP"}}};if(session&&"expires"in session&&session.expires<(new Date).getTime()/1E3||!session&&o.autologin){log("Callback");hello.login(service,{display:"none"},function(r){if(typeof r==="object"&&"error"in r){callback(r);return}request()});
return{status:"Signing in"}}else return request()};if(typeof url==="function")url(p,getPath);else getPath(url)}else log('The path "'+p.path+'" is not recognised')},getAuthResponse:function(service){return _store(service||this.service())},subscribe:function(evt,callback){log("Subscribed",evt,callback);var p=_arguments({evt:"s!",callback:"f!"},arguments);if(!p)return false;listeners[p.evt]=[p.callback].concat(listeners[p.evt]||[])},unsubscribe:function(evt,callback){log("Unsubscribe",evt,callback);
var p=_arguments({evt:"s!",callback:"f"},arguments);if(!p)return false;for(var i=0;i<listeners[p.evt].length;i++)if(!p.callback||listeners[p.evt][i]===p.callback)listeners[p.evt]=listeners[p.evt].splice(i,1)},trigger:function(evt,data){log("Trigger",evt,JSON.stringify(listeners));for(var x in listeners)if(listeners.hasOwnProperty(x))if(evt.indexOf(x)>-1)for(var i=0;i<listeners[x].length;i++)listeners[x][i].call(this,data)},_param:_param,_store:_store,_append:_append,_merge:_merge};function authCallback(network,
obj){_store(obj.network,obj);if(!("display"in p)||p.display!=="page"){var win=window.opener||window.parent;if(win&&"hello"in win&&win.hello){var cb=obj.callback;try{delete obj.callback}catch(e){}if(obj.error)win.hello.trigger(obj.network+":"+cb+".failed",obj);else{win.hello.trigger(obj.network+":"+cb+".login",{network:obj.network,authResponse:obj});win.hello._store(obj.network,obj)}_store(obj.network,obj)}window.close();log("Trying to close window");return}}var p=_param(window.location.hash||null);
if(!p)p=_param(window.location.search);if(p&&"state"in p){try{var a=JSON.parse(p.state);p=_merge(p,a)}catch(e){log("Could not decode state parameter")}if("access_token"in p&&p.access_token&&p.network in _services){if(parseInt(p.expires_in,10)===0)p.expires_in=3600*24*7*52;p.expires_in=parseInt(p.expires_in,10);p.expires=(new Date).getTime()/1E3+parseInt(p.expires_in,10);hello.service(p.network);authCallback(p.network,p)}else if("error"in p&&p.error&&p.network in _services){p.error_message=p.error_message||
p.error_description;authCallback("error",p)}if(p&&p.callback&&"result"in p&&p.result)if(p.callback in window.parent)window.parent[p.callback](JSON.parse(p.result))}return hello;function log(){if(typeof console==="undefined"||typeof console.log==="undefined")return;if(typeof console.log==="function")console.log.apply(console,arguments);else console.log(Array.prototype.slice.call(arguments))}function _isArray(o){return Object.prototype.toString.call(o)==="[object Array]"}function _isEmpty(obj){if(!obj)return true;
if(obj&&obj.length>0)return false;if(obj&&obj.length===0)return true;for(var key in obj)if(obj.hasOwnProperty(key))return false;return true}function _diff(a,b){var r=[];for(var i=0;i<b.length;i++)if(_indexOf(a,b[i])===-1)r.push(b[i]);return r}function _domInstance(type,data){var test="HTML"+(type||"").replace(/^[a-z]/,function(m){return m.toUpperCase()})+"Element";if(window[test])return data instanceof window[test];else if(window.Element)return data instanceof window.Element&&(!type||data.tagName===
type);else return!(data instanceof Object||data instanceof Array||data instanceof String||data instanceof Number)&&data.tagName&&data.tagName===type}function _indexOf(a,s){if(a.indexOf)return a.indexOf(s);for(var j=0;j<a.length;j++)if(a[j]===s)return j;return-1}function _param(s){var b,a={},m;if(typeof s==="string"){m=s.replace(/^[\#\?]/,"").match(/([^=\/\&]+)=([^\&]+)/g);log(m);if(m)for(var i=0;i<m.length;i++){b=m[i].split("=");a[b[0]]=decodeURIComponent(b[1])}return a}else{var o=s;a=[];for(var x in o)if(o.hasOwnProperty(x))if(o.hasOwnProperty(x))a.push([x,
o[x]==="?"?"?":encodeURIComponent(o[x])].join("="));return a.join("&")}}function _store(name,value,days){var hello=JSON.parse(localStorage.getItem("hello"))||{};if(name&&typeof value==="undefined")return hello[name];else if(name&&value==="")try{delete hello[name]}catch(e){hello[name]=null}else if(name)hello[name]=value;else return hello;localStorage.setItem("hello",JSON.stringify(hello));return hello}function _unique(a){if(typeof a!=="object")return[];var r=[];for(var i=0;i<a.length;i++)if(!a[i]||
a[i].length===0||_indexOf(r,a[i])!==-1)continue;else r.push(a[i]);return r}function _merge(a,b){var x,r={};if(typeof a==="object"&&typeof b==="object"){for(x in a)if(a.hasOwnProperty(x)){r[x]=a[x];if(x in b)r[x]=_merge(a[x],b[x])}for(x in b)if(b.hasOwnProperty(x))if(!(x in a))r[x]=b[x]}else r=b;return r}function _arguments(o,args){var p={},i=0,t=null,x=null;for(x in o)if(o.hasOwnProperty(x))break;if(args.length===1&&typeof args[0]==="object"&&o[x]!="o!")return args[0];for(x in o)if(o.hasOwnProperty(x)){t=
typeof args[i];if(typeof o[x]==="function"&&o[x].test(args[i])||typeof o[x]==="string"&&(o[x].indexOf("s")>-1&&t==="string"||o[x].indexOf("o")>-1&&t==="object"||o[x].indexOf("i")>-1&&t==="number"||o[x].indexOf("a")>-1&&t==="object"||o[x].indexOf("f")>-1&&t==="function"))p[x]=args[i++];else if(typeof o[x]==="string"&&o[x].indexOf("!")>-1){log("Whoops! "+x+" not defined");return false}}return p}function _realPath(path){if(path.indexOf("/")===0)path=window.location.protocol+"//"+window.location.host+
path;else if(!path.match(/^https?\:\/\//))path=(window.location.href.replace(/#.*/,"").replace(/\/[^\/]+$/,"/")+path).replace(/\/\.\//g,"/");while(/\/[^\/]+\/\.\.\//g.test(path))path=path.replace(/\/[^\/]+\/\.\.\//g,"/");return path}function _append(node,attr,target){var n=typeof node==="string"?document.createElement(node):node;if(typeof attr==="object")if("tagName"in attr)target=attr;else for(var x in attr)if(attr.hasOwnProperty(x))if(typeof attr[x]==="object")for(var y in attr[x]){if(attr[x].hasOwnProperty(y))n[x][y]=
attr[x][y]}else if(x==="html")n.innerHTML=attr[x];else if(!/^on/.test(x))n.setAttribute(x,attr[x]);else n[x]=attr[x];if(target==="body")(function self(){if(document.body)document.body.appendChild(n);else setTimeout(self,16)})();else if(typeof target==="object")target.appendChild(n);else if(typeof target==="string"){log(target);document.getElementsByTagName(target)[0].appendChild(n)}return n}function _jsonp(path,data,callback){path+=(path.indexOf("?")===-1?"?":"&")+_param(data);var cb_name="__lx_jsonp"+
_jsonp_counter++,bool=0,head=document.getElementsByTagName("head")[0],operafix,script,result={error:{message:"server_error",code:"server_error"}},cb=function(){if(!bool++)window.setTimeout(function(){callback(result);head.removeChild(script)},0)};window[cb_name]=function(json){result=json;try{delete window[cb_name]}catch(e){}};script=_append("script",{id:cb_name,name:cb_name,src:path.replace(new RegExp("=\\?(&|$)"),"="+cb_name+"$1"),async:true,onload:cb,onerror:cb,onreadystatechange:function(){if(/loaded|complete/i.test(this.readyState))cb()}});
if(window.navigator.userAgent.toLowerCase().indexOf("opera")>-1){operafix=_append("script",{text:"document.getElementById('"+cb_name+"').onerror();"});script.async=false}window.setTimeout(function(){result={error:{message:"timeout",code:"timeout"}};cb()},_timeout);head.appendChild(script);if(operafix)head.appendChild(operafix);return script.src}function _post(url,data,options,callback){var form=null,reenableAfterSubmit=[],newform,i=0,x=null,bool=0,cb=function(r){if(!bool++){try{if(newform)newform.parentNode.removeChild(newform)}catch(e){log("could not remove iframe")}for(var i=
0;i<reenableAfterSubmit.length;i++)if(reenableAfterSubmit[i])reenableAfterSubmit[i].setAttribute("disabled",false);callback(r)}};var callbackID="ifrmhack_"+parseInt(Math.random()*1E6,10).toString(16);window[callbackID]=cb;var win;try{win=document.createElement('<iframe name="'+callbackID+'">')}catch(e){win=document.createElement("iframe")}win.name=callbackID;win.id=callbackID;win.style.display="none";if(options&&options.callbackonload)win.onload=function(){cb({response:"posted",message:"Content was posted"})};
setTimeout(function(){cb({error:{code:"timeout",message:"The post operation timed out"}})},_timeout);document.body.appendChild(win);url+="&suppress_response_codes=true&redirect_uri="+encodeURIComponent(_options.redirect_uri)+"&state="+JSON.stringify({callback:callbackID})+"&callbackUrl="+encodeURIComponent(_options.redirect_uri)+"&redirect-uri="+encodeURIComponent(_options.redirect_uri);if(_domInstance("form",data)){form=data.form;for(i=0;i<form.elements.length;i++)if(form.elements[i]!==data)form.elements[i].setAttribute("disabled",
true);data=form}if(_domInstance("form",data)){form=data;for(i=0;i<form.elements.length;i++)if(!form.elements[i].disabled&&form.elements[i].type==="file"){form.encoding=form.enctype="multipart/form-data";form.elements[i].setAttribute("name","file")}}else{for(x in data)if(data.hasOwnProperty(x))if(_domInstance("input",data[x])&&data[x].type==="file"){form=data[x].form;form.encoding=form.enctype="multipart/form-data"}if(!form){form=document.createElement("form");document.body.appendChild(form);newform=
form}for(x in data)if(data.hasOwnProperty(x)){var el=_domInstance("input",data[x])||_domInstance("textArea",data[x])||_domInstance("select",data[x]);if(!el||data[x].form!==form){if(form.elements[x])form.elements[x].parentNode.removeChild(form.elements[x]);var input=document.createElement("input");input.setAttribute("name",x);if(el)input.value=data[x].value;else if(_domInstance(null,data[x]))input.value=data[x].innerHTML||data[x].innerText;else input.value=data[x];form.appendChild(input)}else if(el&&
data[x].name!==x){data[x].setAttribute("name",x);data[x].name=x}}for(i=0;i<form.children.length;i++)if(!(form.children[i].name in data)&&form.children[i].getAttribute("disabled")!==true){form.children[i].setAttribute("disabled",true);reenableAfterSubmit.push(form.children[i])}}form.setAttribute("method","POST");form.setAttribute("action",url);form.setAttribute("target",callbackID);form.target=callbackID;setTimeout(function(){form.submit()},100)}function _dataToJSON(p){var data=p.data;if(_domInstance("form",
data)){var kids=data.elements;var json={};for(var i=0;i<kids.length;i++)if(kids[i].type==="file")if("FormData"in window){json[kids[i].name]=kids[i];break}else{if(!("files"in kids[i]))return false}else json[kids[i].name]=kids[i].value||kids[i].innerHTML;data=json}if(_domInstance("input",data))if("files"in data){var o={};o[data.name]=data.files;data=o}else return false;if("File"in window&&data instanceof window.File||"Blob"in window&&data instanceof window.Blob||"FileList"in window&&data instanceof
window.FileList)data={"file":data};if(!("FormData"in window&&data instanceof window.FormData))for(var x in data)if(data.hasOwnProperty(x))if("FileList"in window&&data[x]instanceof window.FileList)if(data[x].length===1)data[x]=data[x][0];else log("We were expecting the FileList to contain one file");else if(_domInstance("input",data[x])&&data[x].type==="file")if("files"in data[x]);else return false;else if(_domInstance("input",data[x])||_domInstance("select",data[x])||_domInstance("textArea",data[x]))data[x]=
data[x].value;else if(_domInstance(null,data[x]))data[x]=data[x].innerHTML||data[x].innerText;p.data=data;return true}}();